---
published: false
title: GADGET-2 testing simulation
author: Luca Camellini
tags:
  - GADGET-2
  - tools
categories:
  - simulation
  - physic
img: images_posts/Screen Shot 2017-06-30 at 17.15.34.png
---
{% include video id="225969421" provider="vimeo" %}

GADGET-2 simulation requires some libraries in order to work.

**HDF5**: library to manage complex dataset of "all size".

https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.6/hdf5-1.6.9/src/hdf5-1.6.9.tar.gz

Download and extract HDF5 library 1.6.9 (avoid latest release) then go inside the folder.

```
./configure
make
make install

```

Then HDF5 needs two dependency libraries.
If you havenâ€™t homebrew yet on your system just type this on Terminal:

```
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
```

**ZLIB**

```
brew install zlib
```

**SZIP**

```
brew install szip
```

**FFTW**: subrutine library for computin discrete Fourier transform.

http://www.fftw.org/fftw-2.1.5.tar.gz

Download and extract FFTW library 2.1.5 (avoid latest release) then go inside the folder.

```
./configure
make
make install

```

**GSL**: scientific library.

```
brew install gsl
```

**MPICH**: MPI implementation -  Message Passing Interface for parallel computing architectures. 

```
brew install mpich
```

Now you can download GADGET-2: "A code for cosmological simulations of structure formation".

http://wwwmpa.mpa-garching.mpg.de/gadget/gadget-2.0.7.tar.gz

Extract the .tar file and go inside the folder. You have a folder called "parameterfiles" where you find some parameter file including Makefile example depending on which simulation you want to run into. Keep copy of these file before you start to modify them.
Let say you want to run into cluster simulation. You need to copy cluster.Makefile in parent folder and replace existing Makefile renaming it. Then you need to modify Makefile in some points.

Comment periodic boundary conditions "-DPERIODIC" in "Basic operation mode of code"

```
#OPT   +=  -DPERIODIC
```

In "Select target computer" you need to create you own SYSTYPE and comment with # the other.

```
SYSTYPE="mycomputer"
#SYSTYPE="MPA"
```

Then after "Adjust settings for target computer" you should copy a configuration from another SYSTYPE (let say MPA) and change it according to your configuration:

```
ifeq ($(SYSTYPE),"mycomputer")
CC       =  mpicc
OPTIMIZE =  -O3 -Wall
GSL_INCL =  -I/usr/local/Cellar/gsl/2.3/include
GSL_LIBS =  -L/usr/local/Cellar/gsl/2.3/lib
FFTW_INCL=  -I/Users/yourname/Documents/Gadget-2/fftw-2.1.5/include
FFTW_LIBS=  -L/Users/Luca/Documents/Gadget-2/fftw-2.1.5/lib
MPICHLIB =  -L/usr/local/Cellar/mpich/3.2_3/lib
HDF5INCL =  -I/Users/Luca/Documents/Gadget-2/hdf5-1.6.9/hdf5/include
HDF5LIB  =  -L/Users/Luca/Documents/Gadget-2/hdf5-1.6.9/hdf5/lib -lhdf5 -lz
endif
```

Libaray installed with brew should be the same path above. Please check only the version name.
FFTW and HDF5 should be where you want. I put it inside Gadget-2 parent folder. Change yourname with your computer name.
After these changes you can save the Makefile and

```
make
```

Probably you should see some warnings but you can skip them.

Next step is to start the simulation. Before you need to move ICs folder inside Gadegt2 folder and create "cluster" folder where the simulation puts the results.

```
mpirun -np 32 ./Gadget2 parameterfiles/cluster.param
```

"-np 32" is the number of processors you want to use. "./Gadget2" is the simulation and "parameterfiles/cluster.param" is the parameter file you want to use.

The simulation begins to calculate every step and periodically save a snapshot inside "cluster" folder. Snapshots are a binary file where you could extract many parameters of each particle simulated. The period of the step can be changed inside "cluster.param" file as well as the snapshot timing (if you want to specify manually this timing you need to set "OutputListFilename" with the name of your timing file:

```
OutputListFilename parameterfiles/outputs_cluster.txt
```

And put the time of each snampshot, one for each row:

```
0.166667
0.250000
0.333333 
0.5
1.0
```

And set in "cluster.param" the parameter "OutputListOn" to 1:

```
OutputListOn             1
```

For more information and to customize your simulation, check these links:

http://wwwmpa.mpa-garching.mpg.de/gadget/users-guide.pdf
